From 7d8f2f6ceabaf11725f73a290c0ad73c4cf3fb58 Mon Sep 17 00:00:00 2001
From: "Fabio M. Di Nitto" <fdinitto@redhat.com>
Date: Thu, 26 Apr 2012 15:50:34 +0200
Subject: [PATCH] rgmanager: fix conditional check for cpglockd startup

Signed-off-by: Fabio M. Di Nitto <fdinitto@redhat.com>
Reviewed-by: Lon Hohberger <lhh@redhat.com>
Reviewed-by: Ryan McCabe <rmccabe@redhat.com>
---
 rgmanager/init.d/rgmanager.in |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/rgmanager/init.d/rgmanager.in b/rgmanager/init.d/rgmanager.in
index e602ba0..8a8c6e3 100644
--- a/rgmanager/init.d/rgmanager.in
+++ b/rgmanager/init.d/rgmanager.in
@@ -78,8 +78,8 @@ stop_cluster()
 start_cpglockd()
 {
 	rings="$(corosync-objctl 2>/dev/null |grep ringnumber | wc -l)"
-	[ "$rings" -gt "1" ] && service cpglockd start
-	while ! cpglockdump > /dev/null 2>&1; do sleep 1; done
+	[ "$rings" -gt "1" ] && service cpglockd start && \
+		while ! cpglockdump > /dev/null 2>&1; do sleep 1; done
 }
 
 rtrn=0
-- 
1.7.7.6


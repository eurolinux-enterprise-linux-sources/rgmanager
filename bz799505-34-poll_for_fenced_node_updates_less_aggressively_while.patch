From aae5ea434ad766063a085f86d0d67faab7fde87d Mon Sep 17 00:00:00 2001
From: Ryan McCabe <rmccabe@redhat.com>
Date: Thu, 26 Apr 2012 14:16:12 -0400
Subject: [PATCH] Poll for fenced node updates less aggressively while
 waiting for fencing to complete.

Signed-off-by: Ryan McCabe <rmccabe@redhat.com>
Reviewed-by: Lon Hohberger <lhh@redhat.com>
Reviewed-by: Fabio M. Di Nitto <fdinitto@redhat.com>
---
 rgmanager/src/daemons/cpglockd.c |   17 +++++++----------
 1 files changed, 7 insertions(+), 10 deletions(-)

diff --git a/rgmanager/src/daemons/cpglockd.c b/rgmanager/src/daemons/cpglockd.c
index f101084..5d0fed9 100644
--- a/rgmanager/src/daemons/cpglockd.c
+++ b/rgmanager/src/daemons/cpglockd.c
@@ -1675,17 +1675,14 @@ main(int argc, char **argv)
 			** don't need to wait for it.
 			*/
 			if (!victim && !x && !pf_node->force_wait) {
-				int retries = 0;
 				/* Wait up to 1s for fenced to set victim */
-				do {
-					usleep(250000);
-					if (fenced_node_info(pf_node->nodeid, &fn) < 0) {
-						logt_print(LOG_DEBUG,
-							"Unable to get fenced data for node %d\n",
-							pf_node->nodeid);
-					} else
-						victim = fn.victim;
-				} while (!victim && retries++ < 4);
+				sleep(1);
+				if (fenced_node_info(pf_node->nodeid, &fn) < 0) {
+					logt_print(LOG_DEBUG,
+						"Unable to get fenced data for node %d\n",
+						pf_node->nodeid);
+				} else
+					victim = fn.victim;
 
 				if (!victim) {
 					logt_print(LOG_DEBUG, "First entry in list and victim == 0, removing %d from pending fencing\n", pf_node->nodeid);
-- 
1.7.7.6

